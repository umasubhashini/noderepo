<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Preskool - Students</title>
    <!-- Favicon -->

	
    <link rel="shortcut icon" href="/public/assets/admin/img/favicon.png">

    <!-- Fontfamily -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;0,900;1,400;1,500;1,700&display=swap" rel="stylesheet"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/public/assets/admin/plugins/bootstrap/css/bootstrap.min.css">

    <!-- Feathericon CSS -->
    <link rel="stylesheet" href="/public/assets/admin/plugins/feather/feather.css">

    <!-- Pe7 CSS -->
    <link rel="stylesheet" href="/public/assets/admin/plugins/icons/flags/flags.css">

    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="/public/assets/admin/css/bootstrap-datetimepicker.min.css">

    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/all.min.css">

    <!-- Select CSS -->
    <link rel="stylesheet" href="/public/assets/admin/plugins/select2/css/select2.min.css">

    <!-- Main CSS -->
    <link rel="stylesheet" href="/public/assets/admin/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/html2canvas.js"></script>

</head>
<body>

<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Header -->
    <%- include('../admin/header') %>
    <!-- /Header -->

    <!-- Sidebar -->
    <%- include('../admin/sidebar') %>
    <!-- /Sidebar -->

    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="content container-fluid">

            <!-- Page Header -->
            <div class="page-header">
                <div class="row align-items-center">
                    <div class="col-sm-12">
                        <div class="page-sub-header">
                            <h3 class="page-title">Card View</h3>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item">User</li>
                                <li class="breadcrumb-item active">ProfessionalCard</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Page Header -->

          
            <!-- Horizontal Card -->
            <div class="card" id="previewCard">
                <div class="card-body">
                    <!-- Render the user details dynamically from the API response -->
                    <div class="v71_14" id="frontview" style="background-image: url('<%= backgroundImage %>');">
                        <span class="v71_18"><%= templateFields[0].fieldValue %></span>
                        <div class="v71_22" id="image">
                            <!-- Add 'style="max-width: 100%; height: auto;"' to ensure the image fits within its container -->
                            <img src="<%= businessCard.Image %>" alt="User Image" style="max-width: 100%; height: auto;">
                        </div>
                        <span class="v71_23"><%= templateFields[1].fieldValue %></span>
                        <span class="v71_24"><%= templateFields[2].fieldValue %></span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Render additional details on the back view -->
                    <div class="v71_8" id="backview" style="background-image: url('<%= backgroundImage %>');">
                        <span class="v71_13"><%= templateFields[3].fieldValue %></span>
                        <div class="v71_25" id="qrcodeContainerPreview">
                            <div class="form-group local-forms">
                                <div id="qrcodeContainer"></div>
                                <label><span class="login-danger"></span></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Download Button -->
            <input type="button" id="downloadButton" class="btn btn-primary" value="Download Card">

            <!-- /Horizontal Card -->


        </div>
    </div>
    <!-- /Page Wrapper -->
    <!-- /Page Wrapper -->

</div>
<!-- /Main Wrapper -->

<!-- jQuery -->
<script src="/public/assets/admin/js/jquery-3.6.0.min.js"></script>

<!-- Bootstrap Core JS -->
<script src="/public/assets/admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Feather Icon JS -->
<script src="/public/assets/admin/js/feather.min.js"></script>

<!-- Slimscroll JS -->
<script src="/public/assets/admin/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Select2 JS -->
<script src="/public/assets/admin/plugins/select2/js/select2.min.js"></script>

<!-- Datepicker Core JS -->
<script src="/public/assets/admin/plugins/moment/moment.min.js"></script>
<script src="/public/assets/admin/js/bootstrap-datetimepicker.min.js"></script>

<!-- Custom JS -->
<script src="/public/assets/admin/js/script.js"></script>

<!-- html2pdf library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/latest/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.0/html2pdf.bundle.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    const bgColor = "<%= backgroundColor %>";
 function updateElements() {
    // Front View
    const frontViewElement = document.getElementById("frontview");

    // Back View
    const backViewElement = document.getElementById("backview");


    // Set background color dynamically
    
    frontViewElement.style.backgroundSize = "cover";
    frontViewElement.style.backgroundColor = bgColor;
    backViewElement.style.backgroundSize = "cover";
    backViewElement.style.backgroundColor = bgColor;
  }

  // Call the function to update elements when the page loads
  window.onload = function () {
    updateElements();
    generateQRCode();
  };

    // Add click event listener to the download button
    document.getElementById('downloadButton').addEventListener('click', function () {
        generateImage();
    });

    function generateImage() {
        var element = document.getElementById('previewCard');

        // Use dom-to-image to convert the element to an image
        domtoimage.toBlob(element)
            .then(function (blob) {
                // Use FileSaver.js to save the blob as a file
                saveAs(blob, 'previewCard.png');
            })
            .catch(function (error) {
                console.error('Error generating image:', error);
            });
    }



    // Add click event listener to the download button
    
  function generatePDF() {
    var element = document.getElementById('previewCard');

    // Use dom-to-image to convert the element to an image
    domtoimage.toBlob(element)
        .then(function (blob) {
            // Use FileSaver.js to save the blob as a file
            saveAs(blob, 'myfile.png');
        })
        .catch(function (error) {
            console.error('Error generating PDF:', error);
        });
}

function generateQRCode() {
    if("<%= templateFields[3].fieldValue %>"!==null){
    var url = "<%= templateFields[3].fieldValue %>";
    var qrcodeContainer = document.getElementById('qrcodeContainer');
    var downloadLink = document.getElementById('downloadLink');
    var qrcodeInput = document.getElementById('qrcodeInput');
    var cardBackgroundColor = document.getElementById('frontview').style.backgroundColor;
    var cardBackgroundImage = document.getElementById('frontview').style.backgroundImage;

    if (url.trim() !== '') {
        qrcodeContainer.innerHTML = '';

        // Create a new QR code with reversed colors and a transparent background
        var qrcode = new QRCode(qrcodeContainer, {
            text: url,
            width: 80,
            height: 80,
            colorDark: '#ffffff',          // Set QR code color to white
            colorLight: 'rgba(255,255,255,0)',  // Set QR code background to transparent
            correctLevel: QRCode.CorrectLevel.H,  // Set error correction level
        });

        // Apply fixed white border to the QR code
        var canvas = qrcodeContainer.firstChild;
        canvas.style.border = '5px solid white';

        // Apply background image to the QR code
        canvas.style.backgroundImage = cardBackgroundImage;
        canvas.style.backgroundSize = 'cover'; // Adjust background size if needed

        // Set the download link properties
        downloadLink.href = canvas.toDataURL("image/png");
        downloadLink.style.display = 'block';

        // Display the URL in the QR code input field
        qrcodeInput.value = url;
    }
}
    else{
        qrcodeInput.value = "";
    }
}

</script>
</body>
</html>